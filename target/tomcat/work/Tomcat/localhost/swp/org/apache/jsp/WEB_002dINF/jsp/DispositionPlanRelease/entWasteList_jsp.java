/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: Apache Tomcat/7.0.47
 * Generated at: 2018-09-01 01:33:52 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp.WEB_002dINF.jsp.DispositionPlanRelease;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;

public final class entWasteList_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent {

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private javax.el.ExpressionFactory _el_expressionfactory;
  private org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public void _jspInit() {
    _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
    _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
  }

  public void _jspDestroy() {
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
        throws java.io.IOException, javax.servlet.ServletException {

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html; charset=UTF-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			"", true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write('\r');
      out.write('\n');

    String appPath=request.getContextPath();
    String ticketId = (String)request.getAttribute("ticketId");

      out.write('\r');
      out.write('\n');
      out.write('\r');
      out.write('\n');
      org.apache.jasper.runtime.JspRuntimeLibrary.include(request, response, "/common/webCommon/user_top.jsp" + "?" + org.apache.jasper.runtime.JspRuntimeLibrary.URLEncode("title", request.getCharacterEncoding())+ "=" + org.apache.jasper.runtime.JspRuntimeLibrary.URLEncode("危废询价", request.getCharacterEncoding()), out, true);
      out.write('\r');
      out.write('\n');
      org.apache.jasper.runtime.JspRuntimeLibrary.include(request, response, "/common/webCommon/wasteCircleMenu.jsp" + "?" + org.apache.jasper.runtime.JspRuntimeLibrary.URLEncode("menuId", request.getCharacterEncoding())+ "=" + org.apache.jasper.runtime.JspRuntimeLibrary.URLEncode("#myIndex", request.getCharacterEncoding()), out, true);
      out.write("\r\n");
      out.write("<link rel=\"stylesheet\" href=\"");
      out.print(appPath);
      out.write("/main/common/elementui/index.css\">\r\n");
      out.write("<link rel=\"stylesheet\" href=\"");
      out.print(appPath);
      out.write("/main/pc/css/publish.css?6\">\r\n");
      out.write("<section id=\"app\">\r\n");
      out.write("    <template>\r\n");
      out.write("    <el-breadcrumb separator=\"/\">\r\n");
      out.write("        <el-breadcrumb-item>危废处置询价</el-breadcrumb-item>\r\n");
      out.write("    </el-breadcrumb>\r\n");
      out.write("    <div  class=\"panel panel-body\">\r\n");
      out.write("            <div class=\"selectTable\">\r\n");
      out.write("                <div class=\"title\">危废处置询价</div>\r\n");
      out.write("                <el-table :data=\"tableData\"  v-loading.body=\"listLoading\" ref=\"dataSelectTable\"\r\n");
      out.write("                          @selection-change=\"handleSelectionChange\"\r\n");
      out.write("                          style=\"width: 100%\">\r\n");
      out.write("                    <el-table-column\r\n");
      out.write("                            type=\"selection\"\r\n");
      out.write("                            width=\"75\">\r\n");
      out.write("                    </el-table-column>\r\n");
      out.write("                    <el-table-column\r\n");
      out.write("                            label=\"危废代码\"\r\n");
      out.write("                            prop=\"wasteCode\">\r\n");
      out.write("                        <template scope=\"scope\">\r\n");
      out.write("                            <div class=\"wasteCodeError\" v-if=\"!scope.row.entWasteId&&scope.row.wasteCodeError\">{{scope.row.wasteCodeError}}</div>\r\n");
      out.write("                            <span v-if=\"scope.row.entWasteId\">{{scope.row.wasteCode}}</span>\r\n");
      out.write("                            <el-autocomplete\r\n");
      out.write("                                    style=\"width: 100%;\"\r\n");
      out.write("                                    :class=\"{'errorBorder':!scope.row.entWasteId&&scope.row.wasteCodeErrorShow}\"\r\n");
      out.write("                                    v-else\r\n");
      out.write("                                    popper-class=\"wasteCode-autocomplete\"\r\n");
      out.write("                                    v-model=\"scope.row['wasteCode']\"\r\n");
      out.write("                                    :fetch-suggestions=\"querySearch\"\r\n");
      out.write("                                    placeholder=\"请输入或选择匹配的八位码\"\r\n");
      out.write("                                    @focus=\"setCurrentIndex(scope.$index)\"\r\n");
      out.write("                                    @select=\"handleSelect\">\r\n");
      out.write("                                <template slot-scope=\"props\">\r\n");
      out.write("                                    <div class=\"name\">{{ props.item.addenterwastecode }}&nbsp;&nbsp;{{ props.item.addenterwastename }}&nbsp;&nbsp;<span class=\"addr\">{{ props.item.addenterwastedesc }}</span></div>\r\n");
      out.write("                                </template>\r\n");
      out.write("                            </el-autocomplete>\r\n");
      out.write("                        </template>\r\n");
      out.write("                    </el-table-column>\r\n");
      out.write("                    <el-table-column\r\n");
      out.write("                            label=\"危废名称\"\r\n");
      out.write("                            prop=\"wasteName\">\r\n");
      out.write("                        <template scope=\"scope\">\r\n");
      out.write("                            <div class=\"wasteCodeError\" v-if=\"!scope.row.entWasteId&&scope.row.wasteNameError\">{{scope.row.wasteNameError}}</div>\r\n");
      out.write("                            <span v-if=\"scope.row.entWasteId\">{{scope.row.wasteName}}</span>\r\n");
      out.write("                            <el-autocomplete\r\n");
      out.write("                                    style=\"width: 100%\"\r\n");
      out.write("                                    :class=\"{'errorBorder':!scope.row.entWasteId&&scope.row.wasteNameErrorShow}\"\r\n");
      out.write("                                    popper-class=\"wasteName-autocomplete\"\r\n");
      out.write("                                    v-model=\"scope.row['wasteName']\"\r\n");
      out.write("                                    :fetch-suggestions=\"querySearchName\"\r\n");
      out.write("                                    :disabled=\"!scope.row.wasteId\"\r\n");
      out.write("                                    @focus=\"setCurrentIndex(scope.$index)\"\r\n");
      out.write("                                    v-else\r\n");
      out.write("                                    placeholder=\"请输入危废名称\"\r\n");
      out.write("                                    @select=\"handleSelectName\"\r\n");
      out.write("                                    @blur=\"changeWasteName\">\r\n");
      out.write("                                <template slot-scope=\"props\">\r\n");
      out.write("                                    <div class=\"name\">{{ props.item.name }}</div>\r\n");
      out.write("                                </template>\r\n");
      out.write("                            </el-autocomplete>\r\n");
      out.write("                        </template>\r\n");
      out.write("                    </el-table-column>\r\n");
      out.write("                    <el-table-column\r\n");
      out.write("                            width=\"300px\"\r\n");
      out.write("                            align=\"center\"\r\n");
      out.write("                            label=\"数量\">\r\n");
      out.write("                        <template scope=\"scope\">\r\n");
      out.write("                            <div class=\"wasteCodeError qualityError\" v-if=\"scope.row.qualityError\" :style=\"scope.row.qualityError.length==6?'width:96px':''\">{{scope.row.qualityError}}</div>\r\n");
      out.write("                            <el-input v-model=\"scope.row['quality']\" style=\"width:150px\" :class=\"{'errorBorder':scope.row.qualityErrorShow}\" @change=\"changeQuality(scope.row,scope.$index)\"></el-input>\r\n");
      out.write("                            <el-select v-model=\"scope.row.unitCode\" placeholder=\"单位\" style=\"width:80px\"  disabled>\r\n");
      out.write("                                <el-option :label=\"item1.value\" :value=\"item1.code\" v-for=\"(item1,index) in unitList\"></el-option>\r\n");
      out.write("                            </el-select>\r\n");
      out.write("                        </template>\r\n");
      out.write("                    </el-table-column>\r\n");
      out.write("                   ");
      out.write("\r\n");
      out.write("                </el-table>\r\n");
      out.write("                <el-row>\r\n");
      out.write("                    <el-col :span=\"12\">\r\n");
      out.write("                        <el-button type=\"text\"  @click=\"addWaste\">+新增危废</el-button>\r\n");
      out.write("                    </el-col>\r\n");
      out.write("                    <el-col :span=\"12\" align=\"right\" class=\"total\">\r\n");
      out.write("                        <span class=\"total-title\">共计：</span><b>{{totalSelectCount}}</b>种危废，<b>{{getTotalQuality()}}</b>\r\n");
      out.write("                    </el-col>\r\n");
      out.write("                </el-row>\r\n");
      out.write("                <div align=\"center\" style=\"margin: 10px 0 30px\">\r\n");
      out.write("                    <el-button type=\"primary publish-btn\" :loading=\"publishLoading\" @click=\"publish\">{{publishLoading?'询价中...':'立即询价'}}</el-button>\r\n");
      out.write("                    ");
      out.write("\r\n");
      out.write("                </div>\r\n");
      out.write("                <div class=\"desc\">\r\n");
      out.write("                    <p>询价说明：</p>\r\n");
      out.write("                    <p>\r\n");
      out.write("                        1、询价后系统将会立即给出参考报价。参考报价不是最终报价<br/>\r\n");
      out.write("                        2、易废网不处置危废，处置危废的服务由易废网的合作单位为你提供。<br/>\r\n");
      out.write("                        3、处置合同由最终和处置单位签订的合同为准。\r\n");
      out.write("                    </p>\r\n");
      out.write("                </div>\r\n");
      out.write("                ");
      out.write("\r\n");
      out.write("                    ");
      out.write("\r\n");
      out.write("                ");
      out.write("\r\n");
      out.write("            </div>\r\n");
      out.write("            <el-dialog :visible.sync=\"dialogVisible\" width=\"520px\" class=\"publishSuccessBg\" :close-on-click-modal=\"false\">\r\n");
      out.write("                <span class=\"xunzhan_count\">{{entRelaseModel.releaseCount}}</span>\r\n");
      out.write("                <a href=\"javascript:\" class=\"guide_close\" @click=\"closeDialog\"></a>\r\n");
      out.write("                <div class=\"xunzhan_text\">");
      out.write("- {{new Date().format&&new Date().format(\"yyyy.MM.dd\")}}获得 -</span></div>\r\n");
      out.write("                <div class=\"myMessage\">\r\n");
      out.write("                    <span class=\"userName\">{{entRelaseModel.releaseUserName}}</span>\r\n");
      out.write("                    <span class=\"entName\">{{entRelaseModel.entName}}</span>\r\n");
      out.write("                </div>\r\n");
      out.write("                <div class=\"other-tip\">\r\n");
      out.write("                    工作人员将在2小时内与您取得联系，<br/>请耐心等待！咨询电话：<a href=\"javascript:\" style=\"text-decoration: underline\">0512-62717018</a>\r\n");
      out.write("                </div>\r\n");
      out.write("                <div class=\"shareDiv\">\r\n");
      out.write("                    <el-dropdown @visible-change=\"command\">\r\n");
      out.write("                        <el-button type=\"primary\" class=\"shareBtn weixin\"><i class=\"icon_weixin\"></i>分享到微信</el-button>\r\n");
      out.write("                        <el-dropdown-menu slot=\"dropdown\" style=\"width: 158px;text-align: center;margin-right: 12px;\">\r\n");
      out.write("                            <div id=\"code\"></div>\r\n");
      out.write("                            <span style=\"font-size:12px;color: #0079de;\">打开微信，扫一扫</span>\r\n");
      out.write("                        </el-dropdown-menu>\r\n");
      out.write("                    </el-dropdown>\r\n");
      out.write("                </div>\r\n");
      out.write("            </el-dialog>\r\n");
      out.write("                ");
      out.write("\r\n");
      out.write("        </div>\r\n");
      out.write("    </template>\r\n");
      out.write("</section>\r\n");
      out.write("<!-- 先引入 Vue -->\r\n");
      out.write("<script src=\"");
      out.print(appPath);
      out.write("/main/common/elementui/vue.min.js\"></script>\r\n");
      out.write("<!-- 引入组件库 -->\r\n");
      out.write("<script src=\"");
      out.print(appPath);
      out.write("/main/common/elementui/index.js\"></script>\r\n");
      out.write("<script src=\"");
      out.print(appPath );
      out.write("/app/js/constants.js\"></script>\r\n");
      out.write("<script src=\"");
      out.print(appPath );
      out.write("/thirdparty/la-number/la-number.js\"></script>\r\n");
      out.write("<script type=\"text/javascript\" src=\"");
      out.print(appPath );
      out.write("/main/common/qrcode.min.js\"></script>\r\n");
      out.write("<script>\r\n");
      out.write("    var vue=new Vue({\r\n");
      out.write("        el: '#app',\r\n");
      out.write("        data: {\r\n");
      out.write("            tableData: [],\r\n");
      out.write("            multipleSelection: [],\r\n");
      out.write("            listLoading:true,\r\n");
      out.write("            dialogVisible:false,\r\n");
      out.write("            totalQtyText:'0吨',\r\n");
      out.write("            totalQtyT:'',\r\n");
      out.write("            entRelaseModel:{},\r\n");
      out.write("            unitList:[],\r\n");
      out.write("            currentIndex:0,\r\n");
      out.write("            releaseId:'',\r\n");
      out.write("            publishLoading:false\r\n");
      out.write("        },\r\n");
      out.write("        created:function() {\r\n");
      out.write("            this.getList();\r\n");
      out.write("            this.getUnitList();\r\n");
      out.write("        },\r\n");
      out.write("        computed:{\r\n");
      out.write("            totalSelectCount:function(){\r\n");
      out.write("                var arr=this.multipleSelection;\r\n");
      out.write("                var count=0;\r\n");
      out.write("                for(var i in arr) {\r\n");
      out.write("                    count++;\r\n");
      out.write("                }\r\n");
      out.write("                return count;\r\n");
      out.write("            },\r\n");
      out.write("\r\n");
      out.write("        },\r\n");
      out.write("        mounted:function () {\r\n");
      out.write("            Vue.nextTick(function () {\r\n");
      out.write("                $('.cell:first').append('全选')\r\n");
      out.write("            });\r\n");
      out.write("        },\r\n");
      out.write("        methods:{\r\n");
      out.write("            getTotalQuality:function(){\r\n");
      out.write("                var arr=this.multipleSelection;\r\n");
      out.write("                var obj = {};\r\n");
      out.write("                for(var i in arr) {\r\n");
      out.write("                    var key = arr[i]['unitValue']||'吨';\r\n");
      out.write("                    var value = parseFloat(arr[i]['quality']||0);\r\n");
      out.write("                    if(key=='吨'||key=='千克'||key=='克'){\r\n");
      out.write("                        switch (key){\r\n");
      out.write("                            case '千克':\r\n");
      out.write("                                value=value/1000;\r\n");
      out.write("                                break;\r\n");
      out.write("                            case '克':\r\n");
      out.write("                                value=value/1000000;\r\n");
      out.write("                                break\r\n");
      out.write("                        }\r\n");
      out.write("                        if(obj['吨']){\r\n");
      out.write("                            obj['吨']=obj['吨']+value;\r\n");
      out.write("                        }else{\r\n");
      out.write("                            obj['吨']=value;\r\n");
      out.write("                        }\r\n");
      out.write("                    }else{\r\n");
      out.write("                        if(obj[key]) {\r\n");
      out.write("                            obj[key] =obj[key]+value ;\r\n");
      out.write("                        } else {\r\n");
      out.write("                            obj[key] = value;\r\n");
      out.write("                        }\r\n");
      out.write("                    }\r\n");
      out.write("                }\r\n");
      out.write("                var str='';\r\n");
      out.write("                for (var prop in obj) {\r\n");
      out.write("                    str+=obj[prop].toFixed(4)+prop+',';\r\n");
      out.write("                }\r\n");
      out.write("                str=str.substring(0,str.length-1);\r\n");
      out.write("                this.totalQtyText=str;\r\n");
      out.write("                this.totalQtyT = obj['吨'];\r\n");
      out.write("                return str||'0吨';\r\n");
      out.write("            },\r\n");
      out.write("            handleSelectionChange:function (val) {\r\n");
      out.write("                this.multipleSelection=val;\r\n");
      out.write("                var arr=[];\r\n");
      out.write("                for(var i in this.multipleSelection){\r\n");
      out.write("                    arr.push(this.multipleSelection[i]['index']);\r\n");
      out.write("                }\r\n");
      out.write("                for(var k in this.tableData){\r\n");
      out.write("                    if(arr.indexOf(this.tableData[k]['index'])==-1){\r\n");
      out.write("                        var item=this.tableData[k];\r\n");
      out.write("                        item.qualityErrorShow=false;\r\n");
      out.write("                        Vue.set(this.tableData,k,item);\r\n");
      out.write("                        vue.clearError(k);\r\n");
      out.write("                    }\r\n");
      out.write("                }\r\n");
      out.write("            },\r\n");
      out.write("            goShipStore:function () {\r\n");
      out.write("              window.location='");
      out.print(appPath);
      out.write("/wastecircle/init.htm?ticketId=");
      out.print(ticketId);
      out.write("';\r\n");
      out.write("            },\r\n");
      out.write("            setCurrentIndex:function (index) {\r\n");
      out.write("                this.currentIndex=index;\r\n");
      out.write("            },\r\n");
      out.write("            command:function (flag) {\r\n");
      out.write("                if(flag&&$(\"#code canvas\").length==0){\r\n");
      out.write("                    var qrcode = new QRCode(document.getElementById(\"code\"), {\r\n");
      out.write("                        width : 142,\r\n");
      out.write("                        height : 142\r\n");
      out.write("                    });\r\n");
      out.write("                    qrcode.makeCode('http://yifeiwang.com/swp/main/mobile/view/grade.html?userId='+globalInit.userId);\r\n");
      out.write("                    ");
      out.write("\r\n");
      out.write("                  }\r\n");
      out.write("            },\r\n");
      out.write("            getList:function () {\r\n");
      out.write("                this.listLoading = true;\r\n");
      out.write("                var _this=this;\r\n");
      out.write("                ajax({\r\n");
      out.write("                    url:'/entWaste/listEntWaste.htm?ticketId=");
      out.print(ticketId);
      out.write("&pageIndex=1&pageSize=100',\r\n");
      out.write("                    data:JSON.stringify({}),\r\n");
      out.write("                    dataType:'json',\r\n");
      out.write("                    contentType:'application/json',\r\n");
      out.write("                    success:function (result) {\r\n");
      out.write("                        console.log(result);\r\n");
      out.write("                        _this.listLoading = false;\r\n");
      out.write("                        if(result.status==1&&result.data.entWasteList&&result.data.entWasteList.length>0){\r\n");
      out.write("                            for(var i in result.data.entWasteList){\r\n");
      out.write("                                result.data.entWasteList[i].index=i;\r\n");
      out.write("                                result.data.entWasteList[i].quality=0;\r\n");
      out.write("                            }\r\n");
      out.write("                            _this.tableData=result.data.entWasteList;\r\n");
      out.write("                        }\r\n");
      out.write("                    }\r\n");
      out.write("                })\r\n");
      out.write("            },\r\n");
      out.write("            getUnitList:function () {\r\n");
      out.write("                var _this=this;\r\n");
      out.write("                ajax({\r\n");
      out.write("                    url:'/codeType/listCodeValue',\r\n");
      out.write("                    data:{\r\n");
      out.write("                        typeCode:'UNIT_TYPE'\r\n");
      out.write("                    },\r\n");
      out.write("                    success:function (data) {\r\n");
      out.write("                        if(data.status==1){\r\n");
      out.write("                            _this.unitList=data.data;\r\n");
      out.write("                            /*for(var i in data.data){\r\n");
      out.write("                                if(data.data[i]['value']=='吨'){\r\n");
      out.write("                                    Vue.set(vue.enterpriseWaste,'unitCode',data.data[i]['code']);\r\n");
      out.write("                                }\r\n");
      out.write("                            }*/\r\n");
      out.write("                        }\r\n");
      out.write("                    }\r\n");
      out.write("                });\r\n");
      out.write("            },\r\n");
      out.write("            deleteRow:function(index, rows) {\r\n");
      out.write("                rows.splice(index, 1);\r\n");
      out.write("            },\r\n");
      out.write("            clearError:function (i) {\r\n");
      out.write("                setTimeout(function () {\r\n");
      out.write("                    var item=vue.tableData[i];\r\n");
      out.write("                    item.wasteCodeError='';\r\n");
      out.write("                    item.wasteNameError='';\r\n");
      out.write("                    item.qualityError='';\r\n");
      out.write("                    Vue.set(vue.tableData,i,item);\r\n");
      out.write("                },2000)\r\n");
      out.write("            },\r\n");
      out.write("            validateAll:function () {\r\n");
      out.write("                var flag=true;\r\n");
      out.write("                var pattern=/^(?=([0-9]{1,10}$|[0-9]{1,7}\\.))(0|[1-9][0-9]*)(\\.[0-9]{1,3})?$/;\r\n");
      out.write("                if(this.multipleSelection.length==0){\r\n");
      out.write("                    $.notify('请选择危废',{status:'info',timeout:2500});\r\n");
      out.write("                    return;\r\n");
      out.write("                }\r\n");
      out.write("                for(var i in this.multipleSelection){\r\n");
      out.write("                    var item=this.multipleSelection[i];\r\n");
      out.write("                    if(item.entWasteId){\r\n");
      out.write("                        if(item.quality==0){\r\n");
      out.write("                            item.qualityError='数量不能为0';\r\n");
      out.write("                            item.qualityErrorShow=true;\r\n");
      out.write("                            flag=false;\r\n");
      out.write("                        }else if(!pattern.test(item.quality)){\r\n");
      out.write("                            item.qualityError='数量总长不超过十位,最多三位小数';\r\n");
      out.write("                            item.qualityErrorShow=true;\r\n");
      out.write("                            flag=false;\r\n");
      out.write("                        }else{\r\n");
      out.write("                            item.qualityError='';\r\n");
      out.write("                            item.qualityErrorShow=false;\r\n");
      out.write("                        }\r\n");
      out.write("                    }else{\r\n");
      out.write("                        if(!item.wasteCode||!item.wasteId){\r\n");
      out.write("                            item.wasteCodeError='请输入并选择危废代码';\r\n");
      out.write("                            item.wasteCodeErrorShow=true;\r\n");
      out.write("                            flag=false;\r\n");
      out.write("                        }else{\r\n");
      out.write("                            item.wasteCodeError='';\r\n");
      out.write("                            item.wasteCodeErrorShow=false;\r\n");
      out.write("                        }\r\n");
      out.write("                        if(!item.wasteName){\r\n");
      out.write("                            item.wasteNameError='请输入或选择危废名称';\r\n");
      out.write("                            item.wasteNameErrorShow=true;\r\n");
      out.write("                            flag=false;\r\n");
      out.write("                        }else if(item.wasteNameRepeat){\r\n");
      out.write("                            item.wasteNameError='该危废名称已存在';\r\n");
      out.write("                            item.wasteNameErrorShow=true;\r\n");
      out.write("                            flag=false;\r\n");
      out.write("                        }else{\r\n");
      out.write("                            item.wasteNameError='';\r\n");
      out.write("                            item.wasteNameErrorShow=false;\r\n");
      out.write("                        }\r\n");
      out.write("                        if(item.quality==0){\r\n");
      out.write("                            item.qualityError='数量不能为0';\r\n");
      out.write("                            item.qualityErrorShow=true;\r\n");
      out.write("                            flag=false;\r\n");
      out.write("                        }else if(!pattern.test(item.quality)){\r\n");
      out.write("                            item.qualityError='数量总长不超过十位,最多三位小数';\r\n");
      out.write("                            item.qualityErrorShow=true;\r\n");
      out.write("                            flag=false;\r\n");
      out.write("                        }else{\r\n");
      out.write("                            item.qualityError='';\r\n");
      out.write("                            item.qualityErrorShow=false;\r\n");
      out.write("                        }\r\n");
      out.write("                    }\r\n");
      out.write("                    Vue.set(this.tableData,item.index,item);\r\n");
      out.write("                    vue.clearError(item.index);\r\n");
      out.write("                }\r\n");
      out.write("                return flag;\r\n");
      out.write("            },\r\n");
      out.write("            publish:function () {\r\n");
      out.write("                this.publishLoading=true;\r\n");
      out.write("                var flag=this.validateAll();\r\n");
      out.write("                if(!flag){\r\n");
      out.write("                    this.publishLoading=false;\r\n");
      out.write("                    return;\r\n");
      out.write("                }\r\n");
      out.write("                var param={\r\n");
      out.write("                    releaseCount:this.multipleSelection.length,\r\n");
      out.write("                    totalAmountDesc:this.totalQtyText,\r\n");
      out.write("                    totalAmount:this.totalQtyT\r\n");
      out.write("                };\r\n");
      out.write("                var entReleaseDetails=[];\r\n");
      out.write("                for(var i in this.multipleSelection){\r\n");
      out.write("                    var obj={};\r\n");
      out.write("                    var item=this.multipleSelection[i];\r\n");
      out.write("                    obj.entWasteId=item['entWasteId'];\r\n");
      out.write("                    obj.releaseAmount=item['quality'];\r\n");
      out.write("                    obj.wasteId=item['wasteId'];\r\n");
      out.write("                    obj.wasteCode=item['wasteCode'];\r\n");
      out.write("                    obj.wasteNameId=item['wasteNameId'];\r\n");
      out.write("                    obj.wasteName=item['wasteName'];\r\n");
      out.write("                    obj.unitCode=item['unitCode'];\r\n");
      out.write("                    entReleaseDetails.push(obj);\r\n");
      out.write("                }\r\n");
      out.write("                param['releaseDetail']=entReleaseDetails;\r\n");
      out.write("                console.log(param);\r\n");
      out.write("                ajax({\r\n");
      out.write("                    url:'/entRelease/saveAndPublish.htm?ticketId='+getParam('ticketId'),\r\n");
      out.write("                    dataType:'json',\r\n");
      out.write("                    contentType:'application/json',\r\n");
      out.write("                    data:JSON.stringify(param),\r\n");
      out.write("                    success:function (result) {\r\n");
      out.write("                        vue.publishLoading=false;\r\n");
      out.write("                        if(result.status==1){\r\n");
      out.write("                            vue.entRelaseModel=result.data.entReleaseModel;\r\n");
      out.write("                            vue.releaseId=result.data.entReleaseModel.releaseId;\r\n");
      out.write("                            collectingUserBehavior(getParam('ticketId'),'RELEASEWASTE');\r\n");
      out.write("                            window.location='");
      out.print(appPath);
      out.write("/entRelease/systemInquiry.htm?ticketId=");
      out.print(ticketId);
      out.write("&releaseId='+vue.releaseId+'&informEntCount='+result.data.entReleaseModel.informEntCount;\r\n");
      out.write("                        }\r\n");
      out.write("                    }\r\n");
      out.write("                })\r\n");
      out.write("            },\r\n");
      out.write("            addWaste:function () {\r\n");
      out.write("                var obj={\r\n");
      out.write("                    wasteCode:'',\r\n");
      out.write("                    wasteName:'',\r\n");
      out.write("                    quality:0,\r\n");
      out.write("                    unitCode:'T',\r\n");
      out.write("                    entWasteId:''\r\n");
      out.write("                };\r\n");
      out.write("                vue.tableData.push(obj);\r\n");
      out.write("                vue.$refs.dataSelectTable.toggleRowSelection(vue.tableData[vue.tableData.length-1], true);\r\n");
      out.write("                ");
      out.write("\r\n");
      out.write("            },\r\n");
      out.write("            querySearch:function(queryString, cb) {\r\n");
      out.write("                ajax({\r\n");
      out.write("                    url:'/entWaste/getWasteIdDropDownList.htm',\r\n");
      out.write("                    data:{\r\n");
      out.write("                        keyword:queryString\r\n");
      out.write("                    },\r\n");
      out.write("                    success:function (result) {\r\n");
      out.write("                        for(var i in result.value){\r\n");
      out.write("                            result.value[i]['addenterwastecode']=result.value[i]['addenterwastecode'].replace(/<font color='red'>/g,'').replace(/<\\/font>/g,'');\r\n");
      out.write("                            result.value[i]['addenterwastename']=result.value[i]['addenterwastename'].replace(/<font color='red'>/g,'').replace(/<\\/font>/g,'');\r\n");
      out.write("                            result.value[i]['addenterwastedesc']=result.value[i]['addenterwastedesc'].replace(/<font color='red'>/g,'').replace(/<\\/font>/g,'');\r\n");
      out.write("                        }\r\n");
      out.write("                        cb(result.value);\r\n");
      out.write("                    }\r\n");
      out.write("                });\r\n");
      out.write("                // 调用 callback 返回建议列表的数据\r\n");
      out.write("            },\r\n");
      out.write("            querySearchName:function (queryString, cb) {\r\n");
      out.write("                ajax({\r\n");
      out.write("                    url:'/entWaste/listWasteName.htm',\r\n");
      out.write("                    data:{\r\n");
      out.write("                        keyword:queryString,\r\n");
      out.write("                        wasteid:this.tableData[this.currentIndex]['wasteId']\r\n");
      out.write("                    },\r\n");
      out.write("                    success:function (result) {\r\n");
      out.write("                        if(result.status==1&&result.data){\r\n");
      out.write("                            cb(result.data);\r\n");
      out.write("                        }\r\n");
      out.write("                    }\r\n");
      out.write("                });\r\n");
      out.write("            },\r\n");
      out.write("            handleSelect:function(item) {\r\n");
      out.write("                console.log(item);\r\n");
      out.write("                var obj=this.tableData[this.currentIndex];\r\n");
      out.write("                obj.wasteCode=item.addenterwastecode;\r\n");
      out.write("                obj.wasteId=item.id;\r\n");
      out.write("                Vue.set(this.tableData,this.currentIndex,obj);\r\n");
      out.write("                this.changeWasteCode();\r\n");
      out.write("            },\r\n");
      out.write("            handleSelectName:function(item) {\r\n");
      out.write("                console.log(item);\r\n");
      out.write("                var obj=this.tableData[this.currentIndex];\r\n");
      out.write("                obj.wasteName=item.name;\r\n");
      out.write("                obj.wasteNameId=item.id;\r\n");
      out.write("                Vue.set(this.tableData,this.currentIndex,obj);\r\n");
      out.write("                this.validateWasteName();\r\n");
      out.write("            },\r\n");
      out.write("            validateWasteName:function () {\r\n");
      out.write("                var obj=this.tableData[this.currentIndex];\r\n");
      out.write("                ajax({\r\n");
      out.write("                    url:'/entWaste/checkWasteNameDuplicate.htm',\r\n");
      out.write("                    async:false,\r\n");
      out.write("                    data:{\r\n");
      out.write("                        wasteId:obj.wasteId,\r\n");
      out.write("                        wasteName:obj.wasteName,\r\n");
      out.write("                        ticketId:ticketId\r\n");
      out.write("                    },\r\n");
      out.write("                    success:function (result) {\r\n");
      out.write("                        if(result.data) {\r\n");
      out.write("                            obj.wasteNameError='该危废名称已存在';\r\n");
      out.write("                            obj.wasteNameErrorShow=true;\r\n");
      out.write("                            obj.wasteNameRepeat=true;\r\n");
      out.write("                            vue.clearError(vue.currentIndex);\r\n");
      out.write("                        } else {\r\n");
      out.write("                            obj.wasteNameError='';\r\n");
      out.write("                            obj.wasteNameErrorShow=false;\r\n");
      out.write("                            obj.wasteNameRepeat=false;\r\n");
      out.write("                        }\r\n");
      out.write("                        Vue.set(vue.tableData,vue.currentIndex,obj);\r\n");
      out.write("                    }\r\n");
      out.write("                })\r\n");
      out.write("            },\r\n");
      out.write("            changeQuality:function (item,index) {\r\n");
      out.write("                var pattern=/^(?=([0-9]{1,10}$|[0-9]{1,7}\\.))(0|[1-9][0-9]*)(\\.[0-9]{1,3})?$/;\r\n");
      out.write("                if(item.quality==0){\r\n");
      out.write("                    item.qualityError='数量不能为0';\r\n");
      out.write("                    item.qualityErrorShow=true;\r\n");
      out.write("                }else if(!pattern.test(item.quality)){\r\n");
      out.write("                    item.qualityError='数量总长不超过十位,最多三位小数';\r\n");
      out.write("                    item.qualityErrorShow=true;\r\n");
      out.write("                }else{\r\n");
      out.write("                    item.qualityError='';\r\n");
      out.write("                    item.qualityErrorShow=false;\r\n");
      out.write("                }\r\n");
      out.write("                Vue.set(vue.tableData,index,item);\r\n");
      out.write("            },\r\n");
      out.write("            changeWasteCode:function () {\r\n");
      out.write("                var obj = this.tableData[this.currentIndex];\r\n");
      out.write("                if (!obj.wasteCode || !obj.wasteId) {\r\n");
      out.write("                    obj.wasteCodeError = '请输入并选择危废代码';\r\n");
      out.write("                    obj.wasteCodeErrorShow = true;\r\n");
      out.write("                } else {\r\n");
      out.write("                    obj.wasteCodeError = '';\r\n");
      out.write("                    obj.wasteCodeErrorShow = false;\r\n");
      out.write("                }\r\n");
      out.write("                Vue.set(this.tableData,this.currentIndex,obj);\r\n");
      out.write("            },\r\n");
      out.write("            changeWasteName:function () {\r\n");
      out.write("                var obj=this.tableData[this.currentIndex];\r\n");
      out.write("                console.log(obj['wasteName']);\r\n");
      out.write("                if(obj['wasteName']){\r\n");
      out.write("                    this.validateWasteName();\r\n");
      out.write("                }\r\n");
      out.write("            },\r\n");
      out.write("            closeDialog:function () {\r\n");
      out.write("//                this.dialogVisible=false;\r\n");
      out.write("                window.location='");
      out.print(appPath);
      out.write("/wastecircle/publishList.htm?ticketId=");
      out.print(ticketId);
      out.write("';\r\n");
      out.write("            },\r\n");
      out.write("            getQualityTextBySelection:function() {\r\n");
      out.write("                var arr=this.tableData;\r\n");
      out.write("                var obj = {};\r\n");
      out.write("                var laNumber = new $.LaNumber();\r\n");
      out.write("                for(var i in arr) {\r\n");
      out.write("                    var key = arr[i]['unitCode'];\r\n");
      out.write("                    var value = parseFloat(arr[i]['quality']);\r\n");
      out.write("                    if(key=='T'||key=='千克'||key=='克'){\r\n");
      out.write("                        switch (key){\r\n");
      out.write("                            case '千克':\r\n");
      out.write("                                value=laNumber.div(value,1000);\r\n");
      out.write("                                break;\r\n");
      out.write("                            case '克':\r\n");
      out.write("                                value=laNumber.div(value,1000000);\r\n");
      out.write("                                break;\r\n");
      out.write("                        }\r\n");
      out.write("                        if(obj['T']){\r\n");
      out.write("                            obj['T']=laNumber.add(obj['T'],value);\r\n");
      out.write("                        }else{\r\n");
      out.write("                            obj['T']=value;\r\n");
      out.write("                        }\r\n");
      out.write("                    }else{\r\n");
      out.write("                        if(obj[key]) {\r\n");
      out.write("                            obj[key] =laNumber.add(obj[key],value) ;\r\n");
      out.write("                        } else {\r\n");
      out.write("                            obj[key] = value;\r\n");
      out.write("                        }\r\n");
      out.write("                    }\r\n");
      out.write("                }\r\n");
      out.write("                var str='';\r\n");
      out.write("                for (var prop in obj) {\r\n");
      out.write("                    str+=obj[prop]+(prop=='T'?'吨':prop)+'，';\r\n");
      out.write("                }\r\n");
      out.write("                str=str.substring(0,str.length-1);\r\n");
      out.write("                this.totalQtyText=str;\r\n");
      out.write("                this.totalQtyT = obj['T'];\r\n");
      out.write("                return str;\r\n");
      out.write("            }\r\n");
      out.write("        }\r\n");
      out.write("\r\n");
      out.write("    })\r\n");
      out.write("</script>\r\n");
      out.write('\r');
      out.write('\n');
      org.apache.jasper.runtime.JspRuntimeLibrary.include(request, response, "/common/webCommon/bottom.jsp", out, true);
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("<script type=\"text/javascript\">\r\n");
      out.write("    $(document).ready(function() {\r\n");
      out.write("        var rs = window.globalInit();\r\n");
      out.write("        rs.done(function () {\r\n");
      out.write("//            init();\r\n");
      out.write("        });\r\n");
      out.write("        Date.prototype.format = function(format)\r\n");
      out.write("        {\r\n");
      out.write("            var o = {\r\n");
      out.write("                \"M+\" : this.getMonth()+1, //month\r\n");
      out.write("                \"d+\" : this.getDate(),    //day\r\n");
      out.write("                \"h+\" : this.getHours(),   //hour\r\n");
      out.write("                \"m+\" : this.getMinutes(), //minute\r\n");
      out.write("                \"s+\" : this.getSeconds(), //second\r\n");
      out.write("                \"q+\" : Math.floor((this.getMonth()+3)/3),  //quarter\r\n");
      out.write("                \"S\" : this.getMilliseconds() //millisecond\r\n");
      out.write("            };\r\n");
      out.write("            if(/(y+)/.test(format)) format=format.replace(RegExp.$1,\r\n");
      out.write("                (this.getFullYear()+\"\").substr(4 - RegExp.$1.length));\r\n");
      out.write("            for(var k in o)if(new RegExp(\"(\"+ k +\")\").test(format))\r\n");
      out.write("                format = format.replace(RegExp.$1,\r\n");
      out.write("                    RegExp.$1.length==1 ? o[k] :\r\n");
      out.write("                        (\"00\"+ o[k]).substr((\"\"+ o[k]).length));\r\n");
      out.write("            return format;\r\n");
      out.write("        }\r\n");
      out.write("    });\r\n");
      out.write("</script>");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try { out.clearBuffer(); } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
